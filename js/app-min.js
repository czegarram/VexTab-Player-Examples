function VexUtils(){}function on_ping(e){e&&(L("Setting up user session."),L("Switching navbar menus..."),$("#public-menu").hide(),$("#user-menu").show(),$("#user-name").text(e)),NoteSpace.article.maybeSetupEditor()}function on_user_updated(e){e.handle==$("#article-body").attr("article-author-handle")&&($("#article-body").attr("article-author-name",e.name),$("#navbar-article-author-name").text("by "+e.name)),e.handle==$("#profile-handle").text()&&($("#profile-handle").text(e.handle),$("#profile-name").text(e.name)),L("User updated: "+e.name+" / "+e.email),VexUtils.FlashMessage("Preferences saved.")}function on_user_registered(e){L("New user registered: "+e.handle),window.location.href="/me"}function on_login(){L("User logged in."),window.location.href="/me"}function on_logout(){L("Goodbye!"),window.location.href="/"}function notespace_common_setup(){NoteSpace.mode=$("#deployment-mode").attr("deployment-mode"),NoteSpace.replica=$("#deployment-mode").attr("replica"),Vex.Flow.Artist.NOLOGO=!0,"PROD"==NoteSpace.mode&&(NoteSpace.can_log=!1),L("Starting NoteSpace: "+NoteSpace.mode+"/"+NoteSpace.replica)}function notespace_setup(){notespace_common_setup(),"BACKUP"==NoteSpace.replica&&VexUtils.FlashAlert("My VexFlow is currently under maintenance. Some functions are disabled.",!0),NoteSpace.setup_ajax_loader(".ajax-loader"),L("Initializing API..."),NoteSpace.api=new NoteSpace.API("/api",{login_handler:on_login,logout_handler:on_logout,ping_handler:on_ping,register_user_handler:on_user_registered,update_user_handler:on_user_updated}),NoteSpace.article=new NoteSpace.Article(NoteSpace.api),NoteSpace.article.maybeSetupNewPage(),NoteSpace.article.maybeSetupArticleList(),L("Setting up user form handlers..."),NoteSpace.forms=new NoteSpace.UserForms(NoteSpace.api)}function isCanvasSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function notespace_embedded_setup(){notespace_common_setup(),L("Starting NoteSpace: "+NoteSpace.mode+"/"+NoteSpace.replica),L("Initialing embedded page."),NoteSpace.api=new NoteSpace.API("/api"),NoteSpace.article=new NoteSpace.Article(NoteSpace.api),NoteSpace.article.render($("#wmd-preview").text())}var Markdown;if(Markdown="object"==typeof exports&&"function"==typeof require?exports:{},function(){function e(e){return e}function t(){return!1}function n(){}function r(){}n.prototype={chain:function(t,n){var r=this[t];if(!r)throw new Error("unknown hook "+t);this[t]=r===e?n:function(e){return n(r(e))}},set:function(e,t){if(!this[e])throw new Error("unknown hook "+e);this[e]=t},addNoop:function(t){this[t]=e},addFalse:function(e){this[e]=t}},Markdown.HookCollection=n,r.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},Markdown.Converter=function(){function e(e){return e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,t,n,r,i,s){return t=t.toLowerCase(),D.set(t,x(n)),i?r:(s&&P.set(t,s.replace(/"/g,"&quot;")),"")})}function t(e){return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,i),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,i),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,i),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,i),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,i)}function i(e,t){var n=t;return n=n.replace(/^\n+/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(H.push(n)-1)+"K\n\n"}function s(e,n){e=p(e);var r="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,r),e=d(e),e=m(e),e=E(e),e=t(e),e=S(e,n)}function o(e){return e=y(e),e=u(e),e=T(e),e=l(e),e=a(e),e=N(e),e=e.replace(/~P/g,"://"),e=x(e),e=w(e),e=e.replace(/  +\n/g," <br>\n")}function u(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=O(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}function a(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,f)}function f(e,t,n,r,i,s,o,u){void 0==u&&(u="");var a=t,f=n.replace(/:\/\//g,"~P"),l=r.toLowerCase(),h=i,p=u;if(""==h)if(""==l&&(l=f.toLowerCase().replace(/ ?\n/g," ")),h="#"+l,void 0!=D.get(l))h=D.get(l),void 0!=P.get(l)&&(p=P.get(l));else{if(!(a.search(/\(\s*\)$/m)>-1))return a;h=""}h=A(h),h=O(h,"*_");var d='<a href="'+h+'"';return""!=p&&(p=c(p),p=O(p,"*_"),d+=' title="'+p+'"'),d+=">"+f+"</a>"}function l(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,h),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,h)}function c(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function h(e,t,n,r,i,s,o,u){var a=t,f=n,l=r.toLowerCase(),h=i,p=u;if(p||(p=""),""==h){if(""==l&&(l=f.toLowerCase().replace(/ ?\n/g," ")),h="#"+l,void 0==D.get(l))return a;h=D.get(l),void 0!=P.get(l)&&(p=P.get(l))}f=O(c(f),"*_[]()"),h=O(h,"*_");var d='<img src="'+h+'" alt="'+f+'"';return p=c(p),p=O(p,"*_"),d+=' title="'+p+'"',d+=" />"}function p(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+o(t)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+o(t)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return"<h"+r+">"+o(n)+"</h"+r+">\n\n"})}function d(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return B?e=e.replace(t,function(e,t,n){var r=t,i=n.search(/[*+-]/g)>-1?"ul":"ol",s=v(r,i);return s=s.replace(/\s+$/,""),s="<"+i+">"+s+"</"+i+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,r){var i=t,s=n,o=r.search(/[*+-]/g)>-1?"ul":"ol",u=v(s,o);return u=i+"<"+o+">\n"+u+"</"+o+">\n"})),e=e.replace(/~0/,"")}function v(e,t){B++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var n=j[t],r=new RegExp("(^[ \\t]*)("+n+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+n+")[ \\t]+))","gm"),i=!1;return e=e.replace(r,function(e,t,n,r){var u=r,a=/\n\n$/.test(u),f=a||u.search(/\n{2,}/)>-1;return f||i?u=s(k(u),!0):(u=d(k(u)),u=u.replace(/\n$/,""),u=o(u)),i=a,"<li>"+u+"</li>\n"}),e=e.replace(/~0/g,""),B--,e}function m(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){function r(e){for(var t="",n=1;n<e.length;++n)t+=e[n]+"\n";return t}var i=t,s=n;i=b(k(i)),i=L(i),i=i.replace(/^\n+/g,""),i=i.replace(/\n+$/g,"");var o=i.split(/\n/),u=r(o);if(o[0].match(/^vextab/))i="<div class='vex-tabdiv visible-on-load' width=750 scale=0.9 show-errors='true' editor='false' style='display:none;'>"+u+"\n</div>";else if(o[0].match(/^chord/))i="<div class='vex-chords'>"+u+"\n</div>";else if(o[0].match(/^fretboard/))i="<div class='vex-fretboard visible-on-load'>"+u+"\n</div>";else if(o[0].match(/^video/)){var a=o[1];a&&(a.replace(/\s+/g,""),i="<div class='vex-video'>"+a+"\n</div>")}else i="<pre><code>"+i+"\n</code></pre>";return"\n\n"+i+"\n\n"+s}),e=e.replace(/~0/,"")}function g(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(H.push(e)-1)+"K\n\n"}function y(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r){var i=r;return i=i.replace(/^([ \t]*)/g,""),i=i.replace(/[ \t]*$/g,""),i=b(i),i=i.replace(/:\/\//g,"~P"),t+"<code>"+i+"</code>"})}function b(e){return e=e.replace(/&/g,"&"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=O(e,"*_{}[]\\",!1)}function w(e){return e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),e=e.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}function E(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=s(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),g("<blockquote>\n"+n+"\n</blockquote>")})}function S(e,t){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var n=e.split(/\n{2,}/g),r=[],i=/~K(\d+)K/,s=n.length,u=0;s>u;u++){var a=n[u];i.test(a)?r.push(a):/\S/.test(a)&&(a=o(a),a=a.replace(/^([ \t]*)/g,"<p>"),a+="</p>",r.push(a))}if(!t){s=r.length;for(var u=0;s>u;u++)for(var f=!0;f;)f=!1,r[u]=r[u].replace(/~K(\d+)K/g,function(e,t){return f=!0,H[t]})}return r.join("\n\n")}function x(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function T(e){return e=e.replace(/\\(\\)/g,M),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,M)}function N(e){e=e.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");var t=function(e,t){return'<a href="'+t+'">'+_.plainLinkText(t)+"</a>"};return e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,t)}function C(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function k(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}function L(e){if(!/\t/.test(e))return e;var t,n=["    ","   ","  "," "],r=0;return e.replace(/[\n\t]/g,function(e,i){return"\n"===e?(r=i+1,e):(t=(i-r)%4,r=i+1,n[t])})}function A(e){if(!e)return"";var t=e.length;return e.replace(F,function(n,r){return"~D"==n?"%24":":"!=n||r!=t-1&&!/[0-9\/]/.test(e.charAt(r+1))?"%"+n.charCodeAt(0).toString(16):":"})}function O(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=new RegExp(r,"g");return e=e.replace(i,M)}function M(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}var _=this.hooks=new n;_.addNoop("plainLinkText"),_.addNoop("preConversion"),_.addNoop("postConversion");var D,P,H,B;this.makeHtml=function(n){if(D)throw new Error("Recursive call to converter.makeHtml");return D=new r,P=new r,H=[],B=0,n=_.preConversion(n),n=n.replace(/~/g,"~T"),n=n.replace(/\$/g,"~D"),n=n.replace(/\r\n/g,"\n"),n=n.replace(/\r/g,"\n"),n="\n\n"+n+"\n\n",n=L(n),n=n.replace(/^[ \t]+$/gm,""),n=t(n),n=e(n),n=s(n),n=C(n),n=n.replace(/~D/g,"$$"),n=n.replace(/~T/g,"~"),n=_.postConversion(n),H=P=D=null,n};var j={ol:"\\d+[.]",ul:"[*+-]"},F=/(?:["'*()[\]:]|~D)/g}}(),function(){function e(e){return e.replace(/<[^>]*>?/gi,t)}function t(e){return e.match(s)||e.match(o)||e.match(u)?e:e.match(/^<div class='vex-/)||e.match(/^<\/div>/)?e:""}function n(e){if(""==e)return"";var t=/<\/?\w+[^>]*(\s|$|>)/g,n=e.toLowerCase().match(t),r=(n||[]).length;if(0==r)return e;for(var i,s,o,u="<p><img><br><li><hr>",a=[],f=[],l=!1,c=0;r>c;c++)if(i=n[c].replace(/<\/?(\w+).*/,"$1"),"div"!=i&&!(a[c]||u.search("<"+i+">")>-1)){if(s=n[c],o=-1,!/^<\//.test(s))for(var h=c+1;r>h;h++)if(!a[h]&&n[h]=="</"+i+">"){o=h;break}-1==o?l=f[c]=!0:a[o]=!0}if(!l)return e;var c=0;return e=e.replace(t,function(e){var t=f[c]?"":e;return c++,t})}var r,i;"object"==typeof exports&&"function"==typeof require?(r=exports,i=require("./Markdown.Converter").Converter):(r=window.Markdown,i=r.Converter),r.getSanitizingConverter=function(){var t=new i;return t.hooks.chain("postConversion",e),t.hooks.chain("postConversion",n),t};var s=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,o=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,u=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}(),"undefined"==typeof MIDI)var MIDI={};if(function(){var e={},t=function(t){var n=new Audio,r=t.split(";")[0];n.id="audio",n.setAttribute("preload","auto"),n.setAttribute("audiobuffer",!0),n.addEventListener("canplaythrough",function(){e[r]=!0},!1),n.src="data:"+t,document.body.appendChild(n)};MIDI.audioDetect=function(n){if("undefined"==typeof Audio)return n({});var r=new Audio;if("undefined"==typeof r.canPlayType)return n(e);var i=r.canPlayType('audio/ogg; codecs="vorbis"'),i="probably"===i||"maybe"===i,r=r.canPlayType("audio/mpeg"),r="probably"===r||"maybe"===r;if(i||r){i&&t("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),r&&t("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var s=(new Date).getTime(),o=window.setInterval(function(){for(var t in e);var r=5e3<(new Date).getTime()-s;(t||r)&&(window.clearInterval(o),n(e))},1)}else n(e)}}(),"undefined"==typeof MIDI&&(MIDI={}),"undefined"==typeof MIDI.Soundfont&&(MIDI.Soundfont={}),function(){MIDI.loadPlugin=function(n){"function"==typeof n&&(n={callback:n});var r=n.instruments||n.instrument||"acoustic_grand_piano";"object"!=typeof r&&(r=[r]),r.map(function(e){return"number"==typeof e&&(e=MIDI.GeneralMIDI.byId[e]),e}),MIDI.soundfontUrl=n.soundfontUrl||MIDI.soundfontUrl||"./soundfont/",MIDI.audioDetect(function(i){var s="";"undefined"==typeof s&&(s=t[window.location.hash]?window.location.hash.substr(1):""),""===s&&(s=navigator.requestMIDIAccess?"webmidi":window.webkitAudioContext?"webaudio":window.Audio?"audiotag":"flash"),e[s]&&e[s](i["audio/ogg"]?"ogg":"mp3",r,n.callback)})};var e={webmidi:function(e,t,n){MIDI.loader&&MIDI.loader.message("Web MIDI API..."),MIDI.WebMIDI.connect(n)},flash:function(e,t,n){MIDI.loader&&MIDI.loader.message("Flash API..."),DOMLoader.script.add({src:"./inc/SoundManager2/script/soundmanager2.js",verify:"SoundManager",callback:function(){MIDI.Flash.connect(n)}})},audiotag:function(e,t,i){MIDI.loader&&MIDI.loader.message("HTML5 Audio API...");var s=n({items:t,getNext:function(t){DOMLoader.script.add({src:MIDI.soundfontUrl+t+"-"+e+".js",verify:"MIDI.Soundfont."+t,callback:function(){MIDI.loader&&MIDI.loader.update(null,"Downloading...",100),s.getNext()}})},onComplete:function(){MIDI.AudioTag.connect(i)}})},webaudio:function(e,t,i){MIDI.loader&&MIDI.loader.message("Web Audio API...");var s=n({items:t,getNext:function(t){DOMLoader.script.add({src:MIDI.soundfontUrl+t+"-"+e+".js",verify:"MIDI.Soundfont."+t,callback:function(){MIDI.loader&&MIDI.loader.update(null,"Downloading...",100),s.getNext()}})},onComplete:function(){MIDI.WebAudioAPI.connect(i)}})}},t={"#webmidi":!0,"#webaudio":!0,"#audiotag":!0,"#flash":!0},n=function(e){var t,n={queue:[]};for(t in e.items)n.queue.push(e.items[t]);return n.getNext=function(){return n.queue.length?(e.getNext(n.queue.shift()),void 0):e.onComplete()},setTimeout(n.getNext,1),n}}(),"undefined"==typeof MIDI&&(MIDI={}),"undefined"==typeof MIDI.Player&&(MIDI.Player={}),function(){var e=MIDI.Player;e.callback=void 0,e.currentTime=0,e.endTime=0,e.restart=0,e.playing=!1,e.timeWarp=1,e.start=e.resume=function(){-1>e.currentTime&&(e.currentTime=-1),f(e.currentTime)},e.pause=function(){var t=e.restart;l(),e.restart=t},e.stop=function(){l(),e.restart=0,e.currentTime=0},e.addListener=function(e){s=e},e.removeListener=function(){s=void 0},e.clearAnimation=function(){e.interval&&window.clearInterval(e.interval)},e.setAnimation=function(t){var n="function"==typeof t?t:t.callback,t=t.interval||30,r=0,s=0,o=0;e.clearAnimation(),e.interval=window.setInterval(function(){if(0!==e.endTime){e.playing?(r=o===e.currentTime?s-(new Date).getTime():0,r=0===e.currentTime?0:e.currentTime-r,o!==e.currentTime&&(s=(new Date).getTime(),o=e.currentTime)):r=e.currentTime;var t=r/1e3,u=t/60,t=60*u+(t-60*u),u=e.endTime/1e3;-1>u-t||n({now:t,end:u,events:i})}},t)},e.loadMidiFile=function(){e.replayer=new Replayer(MidiFile(e.currentData),e.timeWarp),e.data=e.replayer.getData(),e.endTime=a()},e.loadFile=function(t,n){if(e.stop(),-1!==t.indexOf("base64,")){var r=window.atob(t.split(",")[1]);e.currentData=r,e.loadMidiFile(),n&&n(r)}else r=t.split(" - ")[1]||t,document.getElementById("playback-title").innerHTML=r.replace(".mid",""),r=new XMLHttpRequest,r.open("GET",t),r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(){if(4===this.readyState&&200===this.status){for(var t=this.responseText||"",r=[],i=t.length,s=String.fromCharCode,o=0;i>o;o++)r[o]=s(255&t.charCodeAt(o));t=r.join(""),e.currentData=t,e.loadMidiFile(),n&&n(t)}},r.send()};var t,n=[],r=0,i={},s=void 0,o=function(n,r,o,u,a,l){return window.setTimeout(function(){var u={channel:n,note:r,now:o,end:e.endTime,message:a,velocity:l};128===a?delete i[r]:i[r]=u,s&&s(u),e.currentTime=o,e.currentTime===t&&t<e.endTime&&f(t,!0)},o-u)},u=function(){return"WebAudioAPI"===MIDI.lang?MIDI.Player.ctx:(e.ctx||(e.ctx={currentTime:0}),e.ctx)},a=function(){for(var t=e.data,n=t.length,r=.5,i=0;n>i;i++)r+=t[i][1];return r},f=function(i,s){if(e.replayer){s||("undefined"==typeof i&&(i=e.restart),e.playing&&l(),e.playing=!0,e.data=e.replayer.getData(),e.endTime=a());var f,c=0,h=0,p=e.data,d=u(),v=p.length;t=.5,r=d.currentTime;for(var m=0;v>m&&100>h;m++)if(t+=p[m][1],i>t)c=t;else{var i=t-c,g=p[m][0].event;if("channel"===g.type){var y=g.channel;switch(g.subtype){case"noteOn":if(MIDI.channels[y].mute)break;f=g.noteNumber-(e.MIDIOffset||0),n.push({event:g,source:MIDI.noteOn(y,g.noteNumber,g.velocity,i/1e3+d.currentTime),interval:o(y,f,t,c,144,g.velocity)}),h++;break;case"noteOff":if(MIDI.channels[y].mute)break;f=g.noteNumber-(e.MIDIOffset||0),n.push({event:g,source:MIDI.noteOff(y,g.noteNumber,i/1e3+d.currentTime),interval:o(y,f,t,c,128)})}}}}},l=function(){var t=u();for(e.playing=!1,e.restart+=1e3*(t.currentTime-r);n.length;)t=n.pop(),window.clearInterval(t.interval),t.source&&("number"==typeof t.source?window.clearTimeout(t.source):(t=t.source,t.disconnect(0),t.noteOff(0)));for(var o in i)t=i[o],144===i[o].message&&s&&s({channel:t.channel,note:t.note,now:t.now,end:t.end,message:128,velocity:t.velocity});i={}}}(),"undefined"==typeof MIDI&&(MIDI={}),function(){var e=null,t=null,n=MIDI.WebMIDI={};if(n.setVolume=function(e,n){t.send([176+e,7,n])},n.programChange=function(e,n){t.send([192+e,n])},n.noteOn=function(e,n,r,i){t.send([144+e,n,r],1e3*i)},n.noteOff=function(e,n,r){t.send([128+e,n],1e3*r)},n.chordOn=function(e,n,r,i){for(var s=0;s<n.length;s++)t.send([144+e,n[s],r],1e3*i)},n.chordOff=function(e,n,r){for(var i=0;i<n.length;i++)t.send([128,e,n[i],velocity],1e3*r)},n.stopAllNotes=function(){for(var e=0;16>e;e++)t.send([176+e,123,0])},n.getInput=function(){return e.getInputs()},n.getOutputs=function(){return e.getOutputs()},n.connect=function(r){MIDI.technology="Web MIDI API",MIDI.setVolume=n.setVolume,MIDI.programChange=n.programChange,MIDI.noteOn=n.noteOn,MIDI.noteOff=n.noteOff,MIDI.chordOn=n.chordOn,MIDI.chordOff=n.chordOff,MIDI.stopAllNotes=n.stopAllNotes,MIDI.getInput=n.getInput,MIDI.getOutputs=n.getOutputs,navigator.requestMIDIAccess(function(n){e=n,t=e.getOutput(0),r&&r()},function(e){console.log("uh-oh! Something went wrong!  Error code: "+e.code)})},"undefined"==typeof MIDI.WebAudioAPI&&(MIDI.WebAudioAPI={}),window.AudioContext||window.webkitAudioContext){var r,i=window.AudioContext||window.webkitAudioContext,s=MIDI.WebAudioAPI,o={},u=1,a={},f=function(e,t,n,i,s){var o=MIDI.GeneralMIDI.byName[e],u=o.number,f=t[n],l=MIDI.Soundfont[e][f].split(",")[1],l=Base64Binary.decodeArrayBuffer(l);r.decodeAudioData(l,function(r){for(var l=f;3>l.length;)l+="&nbsp;";if("undefined"!=typeof MIDI.loader&&MIDI.loader.update(null,o.instrument+"<br>Processing: "+(100*(n/87)>>0)+"%<br>"+l),r.id=f,i[n]=r,i.length===t.length){for(;i.length;)(r=i.pop())&&(a[u+""+MIDI.keyToNote[r.id]]=r);s(e)}})};s.setVolume=function(e){u=e},s.programChange=function(e,t){MIDI.channels[e].instrument=t},s.noteOn=function(e,t,n,i){if(MIDI.channels[e]){var s=MIDI.channels[e].instrument;r.tempGain=r.createGain();if(a[s+""+t]){i<r.currentTime&&(i+=r.currentTime);var f=r.createBufferSource();return o[e+""+t]=f,f.buffer=a[s+""+t],f.connect(r.destination),e=r.tempGain,n=2*n/100*u-1,e.connect(r.destination),e.gain.value=Math.max(-1,n),f.connect(e),f.start(i||0),f}}},s.noteOff=function(e,t,n){e=r.tempGain;return n=n||0,n<r.currentTime&&(n+=r.currentTime),(e=o[e+""+t])?(e.gain.linearRampToValueAtTime(1,n),e.gain.linearRampToValueAtTime(0,n+.2),e.stop(n+.3),e):void 0},s.chordOn=function(e,t,n,r){for(var i,o={},u=0,a=t.length;a>u;u++)o[i=t[u]]=s.noteOn(e,i,n,r);return o},s.chordOff=function(e,t,n){for(var r,i={},o=0,u=t.length;u>o;o++)i[r=t[o]]=s.noteOff(e,r,n);return i},s.connect=function(e){MIDI.technology="Web Audio API",MIDI.setVolume=s.setVolume,MIDI.programChange=s.programChange,MIDI.noteOn=s.noteOn,MIDI.noteOff=s.noteOff,MIDI.chordOn=s.chordOn,MIDI.chordOff=s.chordOff,MIDI.Player.ctx=r=new i;var t,n=[],o=MIDI.keyToNote;for(t in o)n.push(t);var o=[],u={};t=function(t){delete u[t];for(var n in u)break;n||e()};for(var a in MIDI.Soundfont){u[a]=!0;for(var l=0;l<n.length;l++)f(a,n,l,o,t)}}}if(window.Audio){for(var l=MIDI.AudioTag={},c={},h=1,p=-1,d=[],v={},m=0;12>m;m++)d[m]=new Audio;var g=function(e,t){if(MIDI.channels[e]){var n=MIDI.GeneralMIDI.byId[MIDI.channels[e].instrument].id;if(t=v[t]){var r=(p+1)%d.length;(new Date).getTime();var i=d[r];i.src=MIDI.Soundfont[n][t.id],i.volume=h,i.play(),p=r}}};l.programChange=function(e,t){MIDI.channels[e].instrument=t},l.setVolume=function(e){h=e},l.noteOn=function(e,t,n,r){var i=c[t];if(v[i]){if(r)return window.setTimeout(function(){g(e,i)},1e3*r);g(e,i)}},l.noteOff=function(){},l.chordOn=function(e,t){for(var n in t){var r=c[t[n]];v[r]&&g(e,r)}},l.chordOff=function(){},l.stopAllNotes=function(){for(var e=0,t=d.length;t>e;e++)d[e].pause()},l.connect=function(e){for(var t in MIDI.keyToNote)c[MIDI.keyToNote[t]]=t,v[t]={id:t};MIDI.technology="HTML Audio Tag",MIDI.setVolume=l.setVolume,MIDI.programChange=l.programChange,MIDI.noteOn=l.noteOn,MIDI.noteOff=l.noteOff,MIDI.chordOn=l.chordOn,MIDI.chordOff=l.chordOff,e&&e()}}var y=MIDI.Flash={},b={},w={};y.programChange=function(e,t){MIDI.channels[e].instrument=t},y.setVolume=function(){},y.noteOn=function(e,t,n,r){if(MIDI.channels[e]&&(t=MIDI.GeneralMIDI.byId[MIDI.channels[e].instrument].number+""+b[t],w[t])){if(r)return window.setTimeout(function(){w[t].play({volume:2*n})},1e3*r);w[t].play({volume:2*n})}},y.noteOff=function(){},y.chordOn=function(e,t,n){if(MIDI.channels[e]){var r,e=MIDI.GeneralMIDI.byId[MIDI.channels[e].instrument].number;for(r in t){var i=e+""+b[t[r]];w[i]&&w[i].play({volume:2*n})}}},y.chordOff=function(){},y.stopAllNotes=function(){},y.connect=function(e){soundManager.flashVersion=9,soundManager.useHTML5Audio=!0,soundManager.url="../inc/SoundManager2/swf/",soundManager.useHighPerformance=!0,soundManager.wmode="transparent",soundManager.flashPollingInterval=1,soundManager.debugMode=!1,soundManager.onload=function(){for(var t in MIDI.Soundfont)for(var n=[],r=function(){n.push(this.sID),"undefined"!=typeof MIDI.loader&&MIDI.loader.update(null,"Processing: "+this.sID)},i=0;88>i;i++){var s=b[i+21];w[MIDI.GeneralMIDI.byName[t].number+""+s]=soundManager.createSound({id:s,url:MIDI.soundfontUrl+t+"-mp3/"+s+".mp3",multiShot:!0,autoLoad:!0,onload:r})}MIDI.technology="Flash",MIDI.setVolume=y.setVolume,MIDI.programChange=y.programChange,MIDI.noteOn=y.noteOn,MIDI.noteOff=y.noteOff,MIDI.chordOn=y.chordOn,MIDI.chordOff=y.chordOff;var o=window.setInterval(function(){88===n.length&&(window.clearInterval(o),e&&e())},25)},soundManager.onerror=function(){};for(var t in MIDI.keyToNote)b[MIDI.keyToNote[t]]=t};var E,m=MIDI,S={Piano:"1 Acoustic Grand Piano;2 Bright Acoustic Piano;3 Electric Grand Piano;4 Honky-tonk Piano;5 Electric Piano 1;6 Electric Piano 2;7 Harpsichord;8 Clavinet".split(";"),"Chromatic Percussion":"9 Celesta;10 Glockenspiel;11 Music Box;12 Vibraphone;13 Marimba;14 Xylophone;15 Tubular Bells;16 Dulcimer".split(";"),Organ:"17 Drawbar Organ;18 Percussive Organ;19 Rock Organ;20 Church Organ;21 Reed Organ;22 Accordion;23 Harmonica;24 Tango Accordion".split(";"),Guitar:"25 Acoustic Guitar (nylon);26 Acoustic Guitar (steel);27 Electric Guitar (jazz);28 Electric Guitar (clean);29 Electric Guitar (muted);30 Overdriven Guitar;31 Distortion Guitar;32 Guitar Harmonics".split(";"),Bass:"33 Acoustic Bass;34 Electric Bass (finger);35 Electric Bass (pick);36 Fretless Bass;37 Slap Bass 1;38 Slap Bass 2;39 Synth Bass 1;40 Synth Bass 2".split(";"),Strings:"41 Violin;42 Viola;43 Cello;44 Contrabass;45 Tremolo Strings;46 Pizzicato Strings;47 Orchestral Harp;48 Timpani".split(";"),Ensemble:"49 String Ensemble 1;50 String Ensemble 2;51 Synth Strings 1;52 Synth Strings 2;53 Choir Aahs;54 Voice Oohs;55 Synth Choir;56 Orchestra Hit".split(";"),Brass:"57 Trumpet;58 Trombone;59 Tuba;60 Muted Trumpet;61 French Horn;62 Brass Section;63 Synth Brass 1;64 Synth Brass 2".split(";"),Reed:"65 Soprano Sax;66 Alto Sax;67 Tenor Sax;68 Baritone Sax;69 Oboe;70 English Horn;71 Bassoon;72 Clarinet".split(";"),Pipe:"73 Piccolo;74 Flute;75 Recorder;76 Pan Flute;77 Blown Bottle;78 Shakuhachi;79 Whistle;80 Ocarina".split(";"),"Synth Lead":"81 Lead 1 (square);82 Lead 2 (sawtooth);83 Lead 3 (calliope);84 Lead 4 (chiff);85 Lead 5 (charang);86 Lead 6 (voice);87 Lead 7 (fifths);88 Lead 8 (bass + lead)".split(";"),"Synth Pad":"89 Pad 1 (new age);90 Pad 2 (warm);91 Pad 3 (polysynth);92 Pad 4 (choir);93 Pad 5 (bowed);94 Pad 6 (metallic);95 Pad 7 (halo);96 Pad 8 (sweep)".split(";"),"Synth Effects":"97 FX 1 (rain);98 FX 2 (soundtrack);99 FX 3 (crystal);100 FX 4 (atmosphere);101 FX 5 (brightness);102 FX 6 (goblins);103 FX 7 (echoes);104 FX 8 (sci-fi)".split(";"),Ethnic:"105 Sitar;106 Banjo;107 Shamisen;108 Koto;109 Kalimba;110 Bagpipe;111 Fiddle;112 Shanai".split(";"),Percussive:"113 Tinkle Bell;114 Agogo;115 Steel Drums;116 Woodblock;117 Taiko Drum;118 Melodic Tom;119 Synth Drum".split(";"),"Sound effects":"120 Reverse Cymbal;121 Guitar Fret Noise;122 Breath Noise;123 Seashore;124 Bird Tweet;125 Telephone Ring;126 Helicopter;127 Applause;128 Gunshot".split(";")},x=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},T={byName:{},byId:{},byCategory:{}};for(E in S)for(var N=S[E],C=0,k=N.length;k>C;C++){var L=N[C];if(L){var A=parseInt(L.substr(0,L.indexOf(" ")),10),L=L.replace(A+" ","");T.byId[--A]=T.byName[x(L)]=T.byCategory[x(E)]={id:x(L),instrument:L,number:A,category:E}}}for(m.GeneralMIDI=T,E=MIDI,m={},S=0;16>S;S++)m[S]={instrument:0,mute:!1,mono:!1,omni:!1,solo:!1};for(E.channels=m,MIDI.pianoKeyOffset=21,MIDI.keyToNote={},MIDI.noteToKey={},E="C Db D Eb E F Gb G Ab A Bb B".split(" "),m=21;108>=m;m++)S=E[m%12]+((m-12)/12>>0),MIDI.keyToNote[S]=m,MIDI.noteToKey[m]=S}(),"undefined"==typeof DOMLoader)var DOMLoader={};if("undefined"==typeof XMLHttpRequest){var XMLHttpRequest;!function(){for(var e=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=0;t<e.length;t++){try{e[t]()}catch(n){continue}break}XMLHttpRequest=e[t]}()}if("undefined"==typeof (new XMLHttpRequest).responseText){var IEBinaryToArray_ByteStr_Script="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n</script>\r\n";document.write(IEBinaryToArray_ByteStr_Script),DOMLoader.sendRequest=function(e){var t=XMLHttpRequest();return t.open("GET",e.url,!0),e.responseType&&(t.responseType=e.responseType),e.onerror&&(t.onerror=e.onerror),e.onprogress&&(t.onprogress=e.onprogress),t.onreadystatechange=function(){if(4===t.readyState){if(200===t.status){var n,r=t;n=t.responseBody;for(var i={},s=0;256>s;s++)for(var o=0;256>o;o++)i[String.fromCharCode(s+256*o)]=String.fromCharCode(s)+String.fromCharCode(o);s=IEBinaryToArray_ByteStr(n),n=IEBinaryToArray_ByteStr_Last(n),n=s.replace(/[\s\S]/g,function(e){return i[e]})+n,r.responseText=n}else t=!1;e.onload&&e.onload(t)}},t.setRequestHeader("Accept-Charset","x-user-defined"),t.send(null),t}}else DOMLoader.sendRequest=function(e){var t=new XMLHttpRequest;return t.open(e.data?"POST":"GET",e.url,!0),t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),e.data&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.responseType&&(t.responseType=e.responseType),e.onerror&&(t.onerror=e.onerror),e.onprogress&&(t.onprogress=e.onprogress),t.onreadystatechange=function(n){4===t.readyState&&(200!==t.status&&304!=t.status?e.onerror&&e.onerror(n,!1):e.onload&&e.onload(t))},t.send(e.data),t};"undefined"==typeof DOMLoader&&(DOMLoader={}),function(){DOMLoader.script=function(){return this.loaded={},this.loading={},this},DOMLoader.script.prototype.add=function(e){var t=this;"string"==typeof e&&(e={src:e});var n=e.srcs;"undefined"==typeof n&&(n=[{src:e.src,verify:e.verify}]);var r=document.getElementsByTagName("head")[0],i=function(e,n){t.loaded[e.src]||n&&"undefined"==typeof window[n]||(t.loaded[e.src]=!0,t.loading[e.src]&&t.loading[e.src](),delete t.loading[e.src],e.callback&&e.callback(),"undefined"!=typeof f&&f())},s=[],o=function(n){if("string"==typeof n&&(n={src:n,verify:e.verify}),/([\w\d.])$/.test(n.verify))if(n.test=n.verify,"object"==typeof n.test)for(var o in n.test)s.push(n.test[o]);else s.push(n.test);t.loaded[n.src]||(o=document.createElement("script"),o.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||i(n)},o.onload=function(){i(n)},o.onerror=function(){},o.setAttribute("type","text/javascript"),o.setAttribute("src",n.src),r.appendChild(o),t.loading[n.src]=function(){})},u=function(t){if(t)i(t,t.test);else for(var r=0;r<n.length;r++)i(n[r],n[r].test);for(var o=!0,r=0;r<s.length;r++){var a=s[r];if(a&&-1!==a.indexOf(".")){var a=a.split("."),f=window[a[0]];"undefined"!=typeof f&&(2===a.length?"undefined"==typeof f[a[1]]&&(o=!1):3===a.length&&"undefined"==typeof f[a[1]][a[2]]&&(o=!1))}else"undefined"==typeof window[a]&&(o=!1)}!e.strictOrder&&o?e.callback&&e.callback():setTimeout(function(){u(t)},10)};if(e.strictOrder){var a=-1,f=function(){if(a++,n[a]){var r=n[a],i=r.src;t.loading[i]?t.loading[i]=function(){r.callback&&r.callback(),f()}:t.loaded[i]?f():(o(r),u(r))}else e.callback&&e.callback()};f()}else{for(a=0;a<n.length;a++)o(n[a]);u()}},DOMLoader.script=new DOMLoader.script}(),function(e){e.btoa||(e.btoa=function(e){var t,n,r,i,e=escape(e),s="",o="",u="",a=0;do t=e.charCodeAt(a++),n=e.charCodeAt(a++),o=e.charCodeAt(a++),r=t>>2,t=(3&t)<<4|n>>4,i=(15&n)<<2|o>>6,u=63&o,isNaN(n)?i=u=64:isNaN(o)&&(u=64),s=s+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(u);while(a<e.length);return s}),e.atob||(e.atob=function(e){var t,n,r,i="",s="",o="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(e)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(u++)),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(u++)),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(u++)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(u++)),t=t<<2|n>>4,n=(15&n)<<4|r>>2,s=(3&r)<<6|o,i+=String.fromCharCode(t),64!=r&&(i+=String.fromCharCode(n)),64!=o&&(i+=String.fromCharCode(s));while(u<e.length);return unescape(i)})}(this);var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=Math.ceil(3*e.length/4),t=new ArrayBuffer(t);return this.decode(e,t),t},decode:function(e,t){var n=this._keyStr.indexOf(e.charAt(e.length-1)),r=this._keyStr.indexOf(e.charAt(e.length-1)),i=Math.ceil(3*e.length/4);64==n&&i--,64==r&&i--;for(var s,o,u,a,f=0,l=0,n=t?new Uint8Array(t):new Uint8Array(i),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),f=0;i>f;f+=3)s=this._keyStr.indexOf(e.charAt(l++)),o=this._keyStr.indexOf(e.charAt(l++)),r=this._keyStr.indexOf(e.charAt(l++)),a=this._keyStr.indexOf(e.charAt(l++)),s=s<<2|o>>4,o=(15&o)<<4|r>>2,u=(3&r)<<6|a,n[f]=s,64!=r&&(n[f+1]=o),64!=a&&(n[f+2]=u);return n}};(function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Vex.Flow.Fretboard=function(){function n(e,t){this.paper=e,r("constructor: options=",t),this.options={strings:6,start_fret:1,end_fret:22,tuning:"standard",color:"black",marker_color:"#aaa",x:10,y:20,width:this.paper.view.size.width-20,height:this.paper.view.size.height-40,marker_radius:4,font_face:"Arial",font_size:12,font_color:"black",nut_color:"#aaa",start_fret_text:null},_.extend(this.options,t),this.reset()}var r,i;return n.DEBUG=!1,r=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],Vex.Flow.Fretboard.DEBUG?"undefined"!=typeof console&&null!==console?console.log.apply(console,["(Vex.Flow.Fretboard)"].concat(e.call(t))):void 0:void 0},i=function(e){return new Vex.RERR("FretboardError",e)},n.prototype.reset=function(){if(r("reset()"),this.options.strings<2)throw i("Too few strings: "+this.options.strings);if(this.options.end_fret-this.options.start_fret<3)throw i("Too few frets: "+this.options.end_fret);if(this.x=this.options.x,this.y=this.options.y,this.width=this.options.width,this.nut_width=10,this.start_fret=parseInt(this.options.start_fret,10),this.end_fret=parseInt(this.options.end_fret,10),this.total_frets=this.end_fret-this.start_fret,this.end_fret<=this.start_fret)throw i("Start fret number must be lower than end fret number: "+this.start_fret+" >= "+this.end_fret);return this.start_fret_text=null!=this.options.start_fret_text?this.options.start_fret_text:this.start_fret,this.height=this.options.height-(0===this.start_fret?0:10),this.string_spacing=this.height/(this.options.strings-1),this.fret_spacing=(this.width-this.nut_width)/(this.total_frets-1),this.light_radius=this.string_spacing/2-1,this.calculateFretPositions()},n.prototype.calculateFretPositions=function(){var e,t,n,i,s,o,u,a=this;for(r("calculateFretPositions: width="+this.width),i=this.width-this.nut_width,this.bridge_to_fret=[i],this.fretXs=[0],e=1.05946,t=o=1,u=this.total_frets;u>=1?u>=o:o>=u;t=u>=1?++o:--o)this.bridge_to_fret[t]=i/Math.pow(e,t),this.fretXs[t]=i-this.bridge_to_fret[t];return n=function(e){return e/a.fretXs[a.total_frets]*i},this.fretXs=function(){var e,t,r,i;for(r=this.fretXs,i=[],e=0,t=r.length;t>e;e++)s=r[e],i.push(n(s));return i}.call(this)},n.prototype.hasFret=function(e){var n,r;return t.call(function(){r=[];for(var e=n=this.start_fret-1,t=this.end_fret;t>=n?t>=e:e>=t;t>=n?e++:e--)r.push(e);return r}.apply(this),e)>=0},n.prototype.hasString=function(e){var n;return t.call(function(){n=[];for(var e=1,t=this.options.strings;t>=1?t>=e:e>=t;t>=1?e++:e--)n.push(e);return n}.apply(this),e)>=0},n.prototype.getFretX=function(e){return this.fretXs[e-(this.start_fret-1)]+(this.start_fret>1?3:this.nut_width)},n.prototype.getStringY=function(e){return this.y+(e-1)*this.string_spacing},n.prototype.getFretCenter=function(e,t){var n,r,s,u;if(r=this.options.start_fret,n=this.options.end_fret,!this.hasFret(e))throw i("Invalid fret: "+e);if(!this.hasString(t))throw i("Invalid string: "+t);return s=0,s=0===e?this.getFretX(0)+this.nut_width/2:(this.getFretX(e)+this.getFretX(e-1))/2,u=this.getStringY(t),new this.paper.Point(s,u)},n.prototype.drawNut=function(){var e;return r("drawNut()"),e=new this.paper.Path.RoundRectangle(this.x,this.y-5,this.nut_width,this.height+10),e.strokeColor=this.options.nut_color,e.fillColor=this.options.nut_color},n.prototype.showStartFret=function(){var e;return r("showStartFret()"),e=this.getFretCenter(this.start_fret,1),r("Center: ",e),this.renderText(new this.paper.Point(e.x,this.y+this.height+20),this.start_fret_text)},n.prototype.drawString=function(e){var t,n,r;return t=new this.paper.Path,t.strokeColor=this.options.color,r=this.getStringY(e),n=new this.paper.Point(this.x,r),t.moveTo(n),t.lineTo(n.add([this.width,0]))},n.prototype.drawFret=function(e){var t,n,r;return t=new this.paper.Path,t.strokeColor=this.options.color,r=this.getFretX(e),n=new this.paper.Point(r,this.y),t.moveTo(n),t.lineTo(n.add([0,this.height]))},n.prototype.drawDot=function(e,t,n,r){var i;return null==n&&(n="red"),null==r&&(r=2),i=new this.paper.Path.Circle(new this.paper.Point(e,t),r),i.strokeColor=n,i.fillColor=n},n.prototype.drawMarkers=function(){var e,t,n,i,s,o,u,a,f,l,c,h,p,d,v=this;for(r("drawMarkers"),n=3,o=4,e=2,4===parseInt(this.options.strings,10)&&(n=2,o=3,e=1),t=function(e){var t;return t=new v.paper.Path.Circle(e,v.options.marker_radius),t.strokeColor=v.options.marker_color,t.fillColor=v.options.marker_color},u=this.string_spacing/2,h=[3,5,7,9,15,17,19,21],a=0,l=h.length;l>a;a++)i=h[a],this.hasFret(i)&&(s=this.getFretCenter(i,n).add([0,u]),t(s));for(p=[12,24],d=[],f=0,c=p.length;c>f;f++)i=p[f],this.hasFret(i)?(s=this.getFretCenter(i,e).add([0,u]),t(s),s=this.getFretCenter(i,o).add([0,u]),d.push(t(s))):d.push(void 0);return d},n.prototype.renderText=function(e,t,n,r){var i;return null==n&&(n=this.options.font_color),null==r&&(r=this.options.font_size),i=new this.paper.PointText(e),i.justification="center",i.characterStyle={font:this.options.font_face,fontSize:r,fillColor:n},i.content=t},n.prototype.drawFretNumbers=function(){var e,t,n,r,i,s;i={5:"V",12:"XII",19:"XIX"},s=[];for(n in i)r=i[n],e=parseInt(n,10),this.hasFret(e)?(t=this.getFretCenter(e,6),t.y=this.getStringY(this.options.strings+1),s.push(this.renderText(t,r))):s.push(void 0);return s},n.prototype.lightText=function(e){var t,n,i,s;return t={color:"white",fillColor:"#666"},_.extend(t,e),r("lightUp: ",t),i=this.getFretCenter(t.fret,t.string),n=new this.paper.Path.Circle(i,this.light_radius),n.strokeColor=t.color,n.fillColor=t.fillColor,s=this.string_spacing/5,i.y+=s,null!=t.text&&this.renderText(i,t.text,t.color),this.paper.view.draw()},n.prototype.lightUp=function(e){var t,n,i,s;return null==(i=e.color)&&(e.color="#666"),null==(s=e.fillColor)&&(e.fillColor=e.color),r("lightUp: ",e),n=this.getFretCenter(e.fret,e.string),t=new this.paper.Path.Circle(n,this.light_radius-2),t.strokeColor=e.color,t.fillColor=e.fillColor,this.paper.view.draw()},n.prototype.draw=function(){var e,t,n,i,s,o;for(r("draw()"),e=t=1,i=this.options.strings;i>=1?i>=t:t>=i;e=i>=1?++t:--t)this.drawString(e);for(e=n=s=this.start_fret,o=this.end_fret;o>=s?o>=n:n>=o;e=o>=s?++n:--n)this.drawFret(e);return 1===this.start_fret?this.drawNut():this.showStartFret(),this.drawMarkers(),this.paper.view.draw()},n}(),Vex.Flow.FretboardDiv=function(){function n(e,t){var n;if(this.sel=e,this.id=t,this.options={width:700,height:150,strings:6,frets:17,start:1,"start-text":null,tuning:"standard"},null!=this.sel&&0===$(this.sel).length)throw i("Invalid selector: "+this.sel);null==(n=this.id)&&(this.id=$(this.sel).attr("id")),this.lights=[]}var r,i,s,o,u,a;return n.DEBUG=!1,r=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],Vex.Flow.FretboardDiv.DEBUG?"undefined"!=typeof console&&null!==console?console.log.apply(console,["(Vex.Flow.FretboardDiv)"].concat(e.call(t))):void 0:void 0},i=function(e){return new Vex.RERR("FretboardError",e)},n.prototype.setOption=function(e,n){if(t.call(_.keys(this.options),e)>=0)return r("Option: "+e+"="+n),this.options[e]=n;throw i("Invalid option: "+e)},a=function(e){var t,n,r;t={};for(n in e)switch(r=e[n],n){case"width":case"height":continue;case"strings":t.strings=r;break;case"frets":t.end_fret=r;break;case"tuning":t.tuning=r;break;case"start":t.start_fret=r;break;case"start-text":t.start_fret_text=r;break;default:throw i("Invalid option: "+n)}return t},n.prototype.show=function(e){var n,s,o,u,a,f,l,c;for(o=e.split(/\s+/),u={},a=["fret","frets","string","strings","text","color","note","notes","fill-color"],f=0,l=o.length;l>f;f++){if(s=o[f],n=s.match(/^(\S+)\s*=\s*(\S+)/),c=n[1],t.call(a,c)<0)throw i("Invalid 'show' option: "+n[1]);null!=n&&(u[n[1]]=n[2])}return r("Show: ",u),this.lights.push(u)},n.prototype.parse=function(e){var t,n,i,s,o;for(r("Parsing: "+e),n=e.split(/\n/),s=0,o=n.length;o>s;s++)t=n[s],t.trim(),i=t.match(/^\s*option\s+(\S+)\s*=\s*(\S+)/),null!=i&&this.setOption(i[1],i[2]),i=t.match(/^\s*show\s+(.+)/),null!=i&&this.show(i[1]);return!0},u=function(e){return r("ExtractNumbers: ",e),e.trim(),e.split(/\s*,\s*/)},o=function(e){var t,n,s,o,u,a;for(r("ExtractNotes: ",e),e.trim(),s=e.split(/\s*,\s*/),t=[],u=0,a=s.length;a>u;u++){if(n=s[u],o=n.match(/(\d+)\/(\d+)/),null==o)throw i("Invalid note: "+n);t.push({fret:parseInt(o[1],10),string:parseInt(o[2],10)})}return t},s=function(e){var t,n,r,s,a,f,l,c,h,p,d,v,m;if(null!=e.fret&&(n=u(e.fret)),null!=e.frets&&(n=u(e.frets)),null!=e.string&&(l=u(e.string)),null!=e.strings&&(l=u(e.strings)),null!=e.note&&(a=o(e.note)),null!=e.notes&&(a=o(e.notes)),(null==n||null==l)&&null==a)throw i("No frets or strings specified on line");if(r=[],null!=n&&null!=l)for(c=0,d=n.length;d>c;c++)for(t=n[c],h=0,v=l.length;v>h;h++)f=l[h],r.push({fret:parseInt(t,10),string:parseInt(f,10)});if(null!=a)for(p=0,m=a.length;m>p;p++)s=a[p],r.push(s);return r},n.prototype.lightsCameraAction=function(){var e,t,n,i,o,u,a;for(r(this.lights),u=this.lights,a=[],i=0,o=u.length;o>i;i++)e=u[i],n=s(e),a.push(function(){var i,s,o;for(o=[],i=0,s=n.length;s>i;i++)t=n[i],null!=e.color&&(t.color=e.color),null!=e["fill-color"]&&(t.fillColor=e["fill-color"]),r("Lighting up: ",t),null!=e.text?(t.text=e.text,o.push(this.fretboard.lightText(t))):o.push(this.fretboard.lightUp(t));return o}.call(this));return a},n.prototype.build=function(e){var t,n;return null==e&&(e=null),r("Creating canvas id="+this.id+" "+this.options.width+"x"+this.options.height),null==e&&(e=$(this.sel).text()),this.parse(e),t=$("<canvas id="+this.id+">").attr("width",this.options.width).attr("height",this.options.height).attr("id",this.id).width(this.options.width),$(this.sel).replaceWith(t),n=new paper.PaperScope,n.setup(document.getElementById(this.id)),this.fretboard=new Vex.Flow.Fretboard(n,a(this.options)),this.fretboard.draw(),this.lightsCameraAction()},n}()}).call(this),function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Vex.Flow.Player=function(){function n(e,t){this.artist=e,s("Initializing player: ",t),this.options={instrument:"acoustic_grand_piano",tempo:120,show_controls:!0,soundfont_url:"/soundfont/",overlay_class:"vextab-player"},null!=t&&_.extend(this.options,t),s("Using soundfonts in: "+this.options.soundfont_url),this.interval_id=null,this.paper=null,this.reset()}var r,i,s,o,u,a,f;return n.DEBUG=!1,n.INSTRUMENTS_LOADED={},s=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],Vex.Flow.Player.DEBUG?"undefined"!=typeof console&&null!==console?console.log.apply(console,["(Vex.Flow.Player)"].concat(e.call(t))):void 0:void 0},r=Vex.Flow.Fraction,o=Vex.Flow.RESOLUTION,f=Vex.Flow.Music.noteValues,u=Vex.drawDot,i={acoustic_grand_piano:0,acoustic_guitar_nylon:24,acoustic_guitar_steel:25,electric_guitar_jazz:26,distortion_guitar:30,electric_bass_finger:33,electric_bass_pick:34,trumpet:56,brass_section:61,soprano_sax:64,alto_sax:65,tenor_sax:66,baritone_sax:67,flute:73,synth_drum:118},n.prototype.setArtist=function(e){return this.artist=e,this.reset()},n.prototype.setTempo=function(e){return s("New tempo: ",e),this.options.tempo=e,this.reset()},n.prototype.setInstrument=function(e){if(s("New instrument: ",e),t.call(_.keys(i),e)<0)throw new Vex.RERR("PlayerError","Invalid instrument: "+e);return this.options.instrument=e,this.reset()},n.prototype.reset=function(){return this.artist.attachPlayer(this),this.tick_notes={},this.all_ticks=[],this.tpm=this.options.tempo*(o/4),this.refresh_rate=25,this.ticks_per_refresh=this.tpm/(60*(1e3/this.refresh_rate)),this.total_ticks=0,null!=this.marker&&(this.marker.remove(),this.marker=null),this.stop()},a=function(e,t,n){var r,i,s,o,u,a;return r=e.canvas,s=r.height,a=r.width,o=$("<canvas>"),o.css("position","absolute"),o.css("left",0),o.css("top",0),o.addClass(n),$(r).after(o),i=Vex.Flow.Renderer.getCanvasContext(o.get(0),a,s),i.scale(t,t),u=new paper.PaperScope,u.setup(o.get(0)),{paper:u,canvas:o.get(0)}},n.prototype.removeControls=function(){return null!=this.play_button&&this.play_button.remove(),null!=this.stop_button&&this.stop_button.remove(),null!=this.paper?this.paper.view.draw():void 0},n.prototype.render=function(){var e,t,n,i,o,u,f,c,h,p,d,v,m,g,y,b,w,E,S,x=this;for(this.reset(),t=this.artist.getPlayerData(),this.scale=t.scale,this.paper||(f=a(t.context,t.scale,this.options.overlay_class),this.paper=f.paper),this.marker=new this.paper.Path.Rectangle(0,0,13,85),this.loading_message=new this.paper.PointText(35,12),this.options.show_controls&&(this.play_button=new this.paper.Path.RegularPolygon(new this.paper.Point(25,10),3,7,7),this.play_button.fillColor="#396",this.play_button.opacity=.8,this.play_button.rotate(90),this.play_button.onMouseUp=function(){return x.play()},this.stop_button=new this.paper.Path.Rectangle(3,3,10,10),this.stop_button.fillColor="#396",this.stop_button.opacity=.8,this.stop_button.onMouseUp=function(){return x.stop()}),this.paper.view.draw(),c=t.voices,h=new r(0,1),m=0,b=c.length;b>m;m++){for(v=c[m],o=new r(0,1),n=g=0,w=v.length;w>g;n=++g){for(d=v[n],p=new r(0,1),S=d.getTickables(),y=0,E=S.length;E>y;y++)u=S[y],u.shouldIgnoreTicks()||(e=h.clone(),e.add(p),e.simplify(),i=e.toString(),_.has(this.tick_notes,i)?this.tick_notes[i].notes.push(u):this.tick_notes[i]={tick:e,value:e.value(),notes:[u]},p.add(u.getTicks()));p.value()>o.value()&&o.copy(p)}h.add(o)}return this.all_ticks=_.sortBy(_.values(this.tick_notes),function(e){return e.value}),this.total_ticks=_.last(this.all_ticks),s(this.all_ticks)},n.prototype.updateMarker=function(e,t){return this.marker.fillColor="#369",this.marker.opacity=.2,this.marker.setPosition(new this.paper.Point(e*this.scale,t*this.scale)),this.paper.view.draw()},n.prototype.playNote=function(e){var t,n,r,i,o,u,a,l,h,p,d,v;for(s("("+this.current_ticks+") playNote: ",e),v=[],p=0,d=e.length;d>p;p++)o=e[p],l=o.getAbsoluteX()+4,h=o.getStave().getYForLine(2),null!=this.paper&&this.updateMarker(l,h),o.isRest()||(r=o.getPlayNote(),t=o.getTicks().value()/(this.tpm/60),v.push(function(){var e,s,l,h;for(h=[],e=0,s=r.length;s>e;e++)n=r[e],l=n.split("/"),o=l[0],a=l[1],o=o.trim().toLowerCase(),u=f[o],null!=u&&(i=24+12*a+f[o].int_val,MIDI.noteOn(0,i,127,0),h.push(MIDI.noteOff(0,i,t)));return h}()));return v},n.prototype.refresh=function(){return this.done?(this.stop(),void 0):(this.current_ticks+=this.ticks_per_refresh,this.current_ticks>=this.next_event_tick?(this.playNote(this.all_ticks[this.next_index].notes),this.next_index++,this.next_index>=this.all_ticks.length?this.done=!0:this.next_event_tick=this.all_ticks[this.next_index].tick.value()):void 0)},n.prototype.stop=function(){return s("Stop"),null!=this.interval_id&&window.clearInterval(this.interval_id),null!=this.play_button&&(this.play_button.fillColor="#396"),null!=this.paper&&this.paper.view.draw(),this.interval_id=null,this.current_ticks=0,this.next_event_tick=0,this.next_index=0,this.done=!1},n.prototype.start=function(){var e=this;return this.stop(),s("Start"),null!=this.play_button&&(this.play_button.fillColor="#a36"),MIDI.programChange(0,i[this.options.instrument]),this.interval_id=window.setInterval(function(){return e.refresh()},this.refresh_rate)},n.prototype.play=function(){var e=this;return s("Play: ",this.refresh_rate,this.ticks_per_refresh),Vex.Flow.Player.INSTRUMENTS_LOADED[this.options.instrument]&&!this.loading?this.start():(s("Loading instruments..."),this.loading_message.content="Loading instruments...",this.loading_message.fillColor="green",this.loading=!0,this.paper.view.draw(),MIDI.loadPlugin({soundfontUrl:this.options.soundfont_url,instruments:[this.options.instrument],callback:function(){return Vex.Flow.Player.INSTRUMENTS_LOADED[e.options.instrument]=!0,e.loading=!1,e.loading_message.content="",e.start()}}))},n}()}.call(this),VexUtils.FlashAlert=function(e,t){t?alertify.error(e):alertify.error("Oh Snap! "+e)},VexUtils.FlashMessage=function(e){alertify.success(e)},VexUtils.Param=function(e){return decodeURIComponent(((new RegExp("[?|&]"+e+"="+"([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},VexUtils.Ajax=function(e,t,n,r){L("API call to: "+e),L(t);var i="POST";r&&(i=r),$.ajax({type:i,url:e,data:t,dataType:"json",success:function(e,t,r){return e?(e.success?n(!0,e,t,r,null):(L("API Error: "+e.message),VexUtils.FlashAlert(e.message),n(!1,e,"apierror",r,null)),void 0):(L("Server Error: "+t+" in "+r),VexUtils.FlashAlert("Unexpected server error. Please try again later."),n(!1,null,"servererror",r,null),void 0)},error:function(e,t,r){L("Server Error: "+t),VexUtils.FlashAlert("(Server Error) "+t),n(!1,null,t,e,r)}})},NoteSpace={},NoteSpace.can_log=!0,NoteSpace.mode="UNKNOWN",NoteSpace.api=null,NoteSpace.log=function(e){NoteSpace.can_log&&console.log(e)},L=NoteSpace.log,NoteSpace.setup_ajax_loader=function(e){$(e).hide(),$(e).ajaxStart(function(){$(e).show()}),$(e).ajaxStop(function(){$(e).hide()})},NoteSpace.API=function(e,t){this.url="",e&&(this.url=e),this.logged_in=!1,this.user={id:null,email:"",name:"",handle:"",admin:!1},this.handlers=_.extend({login_handler:null,register_user_handler:null,logout_handler:null,update_user_handler:null,ping_handler:null,create_article_handler:null,delete_article_handler:null,update_article_handler:null},t)},NoteSpace.API.prototype.setHandlers=function(e){_.extend(this.handlers,e)},NoteSpace.Article=function(e){this.api=e,this.converter=new Markdown.getSanitizingConverter,this.has_editor=!1,this.article_saved=!0,this.api.setHandlers({create_article_handler:NoteSpace.Article.on_create,delete_article_handler:NoteSpace.Article.on_delete}),window.onbeforeunload=NoteSpace.Article.on_leave},NoteSpace.Article.sanitizeVideo=function(e){var t=null,n=e.match(/^http:\/\/(www\.)?youtube\.com\/(.*)v=([^&]+)/);return n&&(t=n[3]),n=e.match(/^http:\/\/(www\.)?youtube\.com\/embed\/([^&]+)$/),n&&(t=n[2]),n=e.match(/^http:\/\/(www\.)?youtu\.be\/([^&]+)$/),n&&(t=n[2]),null!=t?"http://www.youtube.com/embed/"+t:null},NoteSpace.Article.update_embed_help_text=function(){_.defer(function(){$("code#embed-code").text('<iframe src="http://static.vexflow.com/embed/articles/'+$("#article-body").attr("article-id")+'" width="100%" height="'+($("div#wmd-preview").height()+26)+'" frameborder="0" scrolling="no"></iframe>')})},NoteSpace.Article.prototype.render=function(e){var t=this.converter.makeHtml(e);$("#wmd-preview").html(t),NoteSpace.Article.update_embed_help_text(),Vex.Flow.TabDiv.NOLOGO=!0,Vex.Flow.TabDiv.HEIGHT_ADJUSTMENT=-20,$(Vex.Flow.TabDiv.SEL).each(function(){$(this).data("vex-tabdiv",new Vex.Flow.TabDiv(this,{soundfont_url:"//static.vexflow.com/soundfont/7/"}))}),$(".vex-tabdiv").show(),$(".vex-video").each(function(){var e=$(this).text(),t=NoteSpace.Article.sanitizeVideo(e);null!=t?(L("Creating video iframe: "+t),$(this).replaceWith($("<iframe>").attr("width",420).attr("height",315).attr("src",t).attr("frameborder",0).attr("allowfullscreen",!0))):(L("Invalid video URL: "+e),$(this).css("color","red"),$(this).text("Unsupported video: "+e+". See help for more information."))}),$(".vex-fretboard").each(function(e){var t="notespace-fretboard-"+e;try{(new Vex.Flow.FretboardDiv(this,t)).build()}catch(n){L(n),$(this).css("color","red"),$(this).text("Fretboard error: "+n.message)}}),$("a#article-updated").hide()},NoteSpace.Article.prototype.setupEditor=function(){var e=this;if(this.has_editor)return L("Editor already setup."),void 0;var t=$("#editor").text();L("Initializing editor...");var n=ace.edit("editor");n.getSession().setUseWorker(!1),n.getSession().setUseWrapMode(!0),n.setShowPrintMargin(!1),n.setValue(t),n.gotoLine(1),n.setTheme("ace/theme/github"),n.getSession().setMode("ace/mode/markdown"),n.getSession().setUseSoftTabs(!0),n.renderer.setShowGutter(!1),L("Loading help text..."),$("#tab3").load("/snippets/help",function(){NoteSpace.Article.update_embed_help_text()}),$("a#article-updated").click(function(){$('#edit-menu a[href="#tab1"]').tab("show")}),$("#preview-tab").on("shown",function(){L("Rendering article...");var t=n.getValue();e.render(t)}),$("a#update-article").data("saved",!0),$("#update-article").click(function(){L("Saving article..."),e.api.update_article($("#article-body").attr("article-id"),{content:n.getValue()},NoteSpace.Article.on_save)}),n.getSession().on("change",function(){$("a#article-updated").show(),$("#article-body").attr("article-author-handle")==e.api.getUser().handle&&($("a#update-article").show(),$("a#update-article").data("saved",!1))}),$("#editor-tab").on("shown",function(){_.defer(function(){n.focus()})}),$("#edit-menu").show(),"edit"==VexUtils.Param("tab")&&$('#edit-menu a[href="#tab2"]').tab("show"),this.has_editor=!0},NoteSpace.Article.prototype.maybeSetupNewPage=function(){$("#editor").length>0&&(L("Rendering static article..."),this.render($("#editor").text()))},NoteSpace.Article.prototype.maybeSetupEditor=function(){(NoteSpace.Article.getCurrentAuthor()==this.api.getUser().handle||"enabled"==VexUtils.Param("source"))&&(L("Article author setup."),NoteSpace.article.setupEditor())},NoteSpace.Article.prototype.maybeSetupArticleList=function(){var e=this;0!=$("a.private-article").length&&($("#article-title-heading").tooltip(),$("#article-title-heading").editable({url:function(t){var n=$(this).attr("article-id"),r=new $.Deferred;return e.api.update_article(n,{title:t.value},function(e){e?(r.resolve(),$("#article-body").attr("article-title",t.value),$("#navbar-article-title").text(t.value)):r.reject("")}),r}}),$("a.private-article").tooltip(),$("a.private-article").click(function(){var t=$(this).attr("article-id"),n=$(this).hasClass("icon-gray"),r=this;e.api.update_article(t,{private_article:n},function(e){e&&$(r).toggleClass("icon-gray",!n)})}),$("a.unlisted-article").tooltip(),$("a.unlisted-article").click(function(){var t=$(this).attr("article-id"),n=$(this).hasClass("icon-gray"),r=this;e.api.update_article(t,{unlisted:n},function(e){e&&$(r).toggleClass("icon-gray",!n)})}),$("a.delete-article").tooltip(),$("a.delete-article").click(function(){var t=$(this).attr("article-id");alertify.set({labels:{ok:"Kill It!",cancel:"Cancel"}}),alertify.confirm("Delete this article?",function(n){n&&e.api.delete_article(t)})}))},NoteSpace.UserForms=function(e){this.api=e}